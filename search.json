[{"path":[]},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"prerequisites","dir":"","previous_headings":"Environment Setup","what":"Prerequisites","title":"neurothresh Build & Test Instructions","text":"","code":"# R >= 4.0 required R --version  # Ensure Xcode CLI tools (macOS) or build-essential (Linux) # macOS: xcode-select --install  # Linux: # sudo apt-get install build-essential"},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"install-dependencies","dir":"","previous_headings":"Environment Setup","what":"Install Dependencies","title":"neurothresh Build & Test Instructions","text":"","code":"# Install R package dependencies Rscript -e \"install.packages(c('Rcpp', 'testthat', 'roxygen2', 'devtools', 'knitr', 'rmarkdown', 'remotes'))\"  # Install neuroim2 from GitHub Rscript -e \"remotes::install_github('bbuchsbaum/neuroim2')\"  # Optional: Install neuroatlas from GitHub Rscript -e \"remotes::install_github('bbuchsbaum/neuroatlas')\"  # Install all package dependencies from DESCRIPTION (including Remotes) Rscript -e \"devtools::install_deps()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"generate-documentation","dir":"","previous_headings":"Build Commands","what":"Generate Documentation","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::document()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"compile-c-code","dir":"","previous_headings":"Build Commands","what":"Compile C++ Code","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"Rcpp::compileAttributes()\" Rscript -e \"devtools::load_all()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"build-package","dir":"","previous_headings":"Build Commands","what":"Build Package","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::build()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"install-package","dir":"","previous_headings":"Build Commands","what":"Install Package","title":"neurothresh Build & Test Instructions","text":"","code":"R CMD INSTALL . # Or: Rscript -e \"devtools::install()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"run-all-tests","dir":"","previous_headings":"Test Commands","what":"Run All Tests","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::test()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"run-specific-test-file","dir":"","previous_headings":"Test Commands","what":"Run Specific Test File","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::test(filter='canonicalize')\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"check-test-coverage","dir":"","previous_headings":"Test Commands","what":"Check Test Coverage","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"covr::package_coverage()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"full-package-check","dir":"","previous_headings":"Quality Checks","what":"Full Package Check","title":"neurothresh Build & Test Instructions","text":"","code":"R CMD check ."},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"cran-style-check","dir":"","previous_headings":"Quality Checks","what":"CRAN-Style Check","title":"neurothresh Build & Test Instructions","text":"","code":"R CMD check --as-cran ."},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"linting-optional","dir":"","previous_headings":"Quality Checks","what":"Linting (Optional)","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"lintr::lint_package()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"load-package-for-interactive-development","dir":"","previous_headings":"Development Workflow","what":"Load Package for Interactive Development","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::load_all()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"quick-iteration-cycle","dir":"","previous_headings":"Development Workflow","what":"Quick Iteration Cycle","title":"neurothresh Build & Test Instructions","text":"","code":"# After making changes: Rscript -e \"devtools::document(); devtools::load_all(); devtools::test()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"full-validation-before-commit","dir":"","previous_headings":"Development Workflow","what":"Full Validation Before Commit","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::check()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"regenerate-rcpp-exports","dir":"","previous_headings":"Rcpp-Specific Commands","what":"Regenerate Rcpp Exports","title":"neurothresh Build & Test Instructions","text":"generates: - src/RcppExports.cpp - R/RcppExports.R","code":"Rscript -e \"Rcpp::compileAttributes()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"compile-c-with-verbose-output","dir":"","previous_headings":"Rcpp-Specific Commands","what":"Compile C++ with Verbose Output","title":"neurothresh Build & Test Instructions","text":"","code":"R CMD SHLIB src/*.cpp"},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"issue-rcpp-not-found","dir":"","previous_headings":"Common Issues","what":"Issue: Rcpp not found","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"install.packages('Rcpp')\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"issue-neuroim2-not-found","dir":"","previous_headings":"Common Issues","what":"Issue: neuroim2 not found","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::install_local('~/code/neuroim2')\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"issue-c-compilation-errors","dir":"","previous_headings":"Common Issues","what":"Issue: C++ compilation errors","title":"neurothresh Build & Test Instructions","text":"Check src/Makevars correct flags Ensure C++11 later: CXX_STD = CXX11 Run Rcpp::compileAttributes() regenerate exports","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"issue-namespace-missing-exports","dir":"","previous_headings":"Common Issues","what":"Issue: NAMESPACE missing exports","title":"neurothresh Build & Test Instructions","text":"","code":"Rscript -e \"devtools::document()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/@AGENT.html","id":"completion-checklist","dir":"","previous_headings":"","what":"Completion Checklist","title":"neurothresh Build & Test Instructions","text":"marking task complete: Code compiles without errors devtools::test() passes relevant tests Roxygen2 documentation complete (@param, @return, @export) devtools::check() passes errors @fix_plan.md updated marking project complete: items @fix_plan.md [x] R CMD check ---cran . passes 0 errors, 0 warnings devtools::test() shows >80% coverage Package installs cleanly via devtools::install()","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":null,"dir":"","previous_headings":"","what":"neurothresh Development Task List","title":"neurothresh Development Task List","text":"IMPORTANT: Mark task [x] IMMEDIATELY completing . batch updates.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"phase-1-infrastructure-done---verify-and-mark","dir":"","previous_headings":"","what":"Phase 1: Infrastructure (DONE - verify and mark)","title":"neurothresh Development Task List","text":"P1-01: Verify DESCRIPTION, NAMESPACE, src/Makevars exist correct P1-02: Run Rscript -e \"Rcpp::compileAttributes()\" verify src/RcppExports.cpp generated P1-03: Run Rscript -e \"devtools::load_all()\" verify package loads","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"phase-2-core-functions-verify-existing-add-docs","dir":"","previous_headings":"","what":"Phase 2: Core Functions (verify existing, add docs)","title":"neurothresh Development Task List","text":"P2-01: Verify canonicalize_stat() exists R/canonicalize.R, add roxygen2 docs, run devtools::document() P2-02: Verify score_set() exists R/scoring.R, add roxygen2 docs P2-03: Verify score_set_stabilized() exists R/scoring.R, add roxygen2 docs P2-04: Verify octree_split() exists R/octree.R, add roxygen2 docs P2-05: Verify generate_null_scores() exists R/permutation.R, add roxygen2 docs P2-06: Verify wy_stepdown() exists R/stepdown.R, add roxygen2 docs P2-07: Verify hier_scan() exists R/hier_scan.R, roxygen2 docs","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"phase-3-baseline-methods-verify-existing-add-docs","dir":"","previous_headings":"","what":"Phase 3: Baseline Methods (verify existing, add docs)","title":"neurothresh Development Task List","text":"P3-01: Verify rft_peak_fwer() exists R/rft.R, add roxygen2 docs P3-02: Verify rft_cluster_fwer() exists R/rft.R, add roxygen2 docs P3-03: Verify tfce_transform() exists R/tfce.R, add roxygen2 docs P3-04: Verify tfce_fwer() exists R/tfce.R, add roxygen2 docs P3-05: Verify cluster_fdr() exists R/cluster_fdr.R, add roxygen2 docs","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"phase-4-documentation-generation","dir":"","previous_headings":"","what":"Phase 4: Documentation Generation","title":"neurothresh Development Task List","text":"P4-01: Run devtools::document() generate man/*.Rd files P4-02: Run R CMD check . ---manual fix warnings undocumented objects P4-03: Ensure exported functions @export tag","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"phase-5-final-verification","dir":"","previous_headings":"","what":"Phase 5: Final Verification","title":"neurothresh Development Task List","text":"P5-01: Run devtools::test() - tests must pass P5-02: Run R CMD check . ---manual ---vignettes - must 0 errors, 0 warnings P5-03: Run ./verify_completion.sh - must output “VERIFICATION PASSED”","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"completion-gate","dir":"","previous_headings":"","what":"COMPLETION GATE","title":"neurothresh Development Task List","text":"GATE: tasks [x] verify_completion.sh passes","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"notes","dir":"","previous_headings":"","what":"Notes","title":"neurothresh Development Task List","text":"code already exists previous implementation Focus DOCUMENTATION - adding roxygen2 comments generating .Rd files R CMD check warnings “Undocumented code objects” must fixed task, IMMEDIATELY mark [x] moving ","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/@fix_plan.html","id":"ad-hoc-reviews","dir":"","previous_headings":"","what":"Ad Hoc Reviews","title":"neurothresh Development Task List","text":"R-001: Review codebase completeness vs docs/discussion library notes R-002: Implement prior normalization hierarchical alpha-spending mode R-003: Fix kappa handling, voxel spacing usage, TFCE outputs, add tests R-004: Add vignette neurothresh overview usage R-005: Add simulation vignette sanity-check tests FWER/power","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":null,"dir":"","previous_headings":"","what":"CLAUDE.md","title":"CLAUDE.md","text":"file provides guidance Claude Code (claude.ai/code) working code repository.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"project-overview","dir":"","previous_headings":"","what":"Project Overview","title":"CLAUDE.md","text":"neurothresh R package neuroimaging statistical thresholding implements: 1. LR-MFT (Likelihood-Ratio Matched-Filter Thresholding) hierarchical stepdown inference - prior-weighted soft evidence aggregation method provably powerful RFT peak-height multi-focal/distributed brain activations 2. Standard baseline methods: RFT peak/cluster FWER, TFCE, cluster-FDR package integrates neuroim2 (volumetric brain imaging data structures) neuroatlas (brain parcellations).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"build--development-commands","dir":"","previous_headings":"","what":"Build & Development Commands","title":"CLAUDE.md","text":"","code":"# Install dependencies Rscript -e \"install.packages(c('Rcpp', 'testthat', 'roxygen2', 'devtools'))\" Rscript -e \"devtools::install_deps()\"  # Build package Rscript -e \"devtools::document()\" R CMD INSTALL .  # Run all tests Rscript -e \"devtools::test()\"  # Run single test file Rscript -e \"testthat::test_file('tests/testthat/test-score-node.R')\"  # Check package (CRAN-style) R CMD check --as-cran .  # Load for interactive development Rscript -e \"devtools::load_all()\"  # Compile Rcpp attributes after modifying C++ code Rscript -e \"Rcpp::compileAttributes()\""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"core-algorithm-flow","dir":"","previous_headings":"Architecture","what":"Core Algorithm Flow","title":"CLAUDE.md","text":"Canonicalize input (Z/t/log10p → standardized Z-equivalent field) Build parcel roots atlas labels prior mass caching κ=0: Variance-stabilized diffuse score U_0(R) = Σπ(v)Z(v) / √Σπ(v)² κ>0: Soft-max score S_κ(R) = (1/κ)·log(Σπ(v)exp(κZ(v)) / Σπ(v)) Combined: T(R) = max(U_0, max_κ S_κ) Westfall-Young step-parcel level FWER control Recursive octree descent significant parcels α-spending One-pass sibling scoring (Rcpp) children split","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"directory-structure","dir":"","previous_headings":"Architecture","what":"Directory Structure","title":"CLAUDE.md","text":"","code":"neurothresh/ ├── R/                      # R source files │   ├── canonicalize.R      # Z/t/log10p → Zeq conversion │   ├── hier_scan.R         # Main entry point │   ├── score_node.R        # Node scoring functions │   ├── wy_stepdown.R       # Westfall-Young step-down │   ├── rft_*.R             # RFT baseline methods │   ├── tfce.R              # TFCE implementation │   └── cluster_fdr.R       # Cluster-FDR methods ├── src/                    # Rcpp C++ code │   ├── octree_split_info.cpp │   ├── score_children_onepass.cpp │   ├── split_indices_bbox.cpp │   └── RcppExports.cpp ├── tests/testthat/         # testthat tests └── docs/discussion/        # Design documents (parts 1-5)"},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"rcpp-c-functions","dir":"","previous_headings":"Architecture","what":"Rcpp C++ Functions","title":"CLAUDE.md","text":"Three critical Rcpp exports performance: - octree_split_info_cpp() - Build child assignment cache π/π² constants - score_children_onepass_cpp() - Score ≤8 children single pass (streaming log-sum-exp) - split_indices_bbox_mass_cpp() - Split indices + compute bboxes + π masses one pass","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"neuroim2-integration-points","dir":"","previous_headings":"Architecture","what":"neuroim2 Integration Points","title":"CLAUDE.md","text":"","code":"# Key classes from neuroim2 DenseNeuroVol      # 3D statistic maps LogicalNeuroVol    # Brain masks ClusteredNeuroVol  # Parcellations (from neuroatlas) NeuroSpace         # Coordinate system  # Key functions index_to_grid(vol, idx)  # Linear index → (i,j,k) grid_to_index(vol, coords)  # (i,j,k) → linear index conn_comp(vol, threshold)  # Connected components for clustering"},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"neuroatlas-integration","dir":"","previous_headings":"Architecture","what":"neuroatlas Integration","title":"CLAUDE.md","text":"","code":"# Load parcellation (returns ClusteredNeuroVol) atlas <- neuroatlas::get_schaefer_atlas(parcels=\"200\", networks=\"7\") cvol <- atlas$atlas  # Access parcel membership lab_vec <- as.integer(atlas_labels[mask_idx])  # Parcel IDs in mask-space"},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"why-lr-mft-beats-rft-peak-height","dir":"","previous_headings":"Algorithm Design Notes","what":"Why LR-MFT Beats RFT Peak-Height","title":"CLAUDE.md","text":"RFT peak-height hard-max detector optimal “one dominant peak.” LR-MFT’s soft evidence aggregation NP-optimal multi-focal alternatives (multiple activation blobs), biologically realistic task fMRI.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"variance-stabilization-u_0","dir":"","previous_headings":"Algorithm Design Notes","what":"Variance Stabilization (U_0)","title":"CLAUDE.md","text":"Without scaling, singleton voxels unit variance large regions tiny variance null. √n_eff scaling (n_eff = Π(R)²/Π_2(R)) ensures fair comparison across scales.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"hierarchical-α-spending","dir":"","previous_headings":"Algorithm Design Notes","what":"Hierarchical α-Spending","title":"CLAUDE.md","text":"Budget allocation: α_child = (α_node - α_test) · w_child w_child ∝ π(child). gives clean FWER proof via union bound + nesting.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/CLAUDE.html","id":"computational-optimization","dir":"","previous_headings":"Algorithm Design Notes","what":"Computational Optimization","title":"CLAUDE.md","text":"one-pass sibling scoring eliminates O(m) vector allocations per permutation streaming parent voxels updating ≤8 child accumulators simultaneously. key making permutation-based inference tractable.","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"project-overview","dir":"","previous_headings":"","what":"Project Overview","title":"neurothresh Development Instructions","text":"building neurothresh, R package neuroimaging statistical thresholding implementing LR-MFT (Likelihood-Ratio Matched-Filter Thresholding) hierarchical stepdown inference. Target Users: Neuroimaging researchers comfortable R/statistics Primary Use Case: Group-level fMRI analysis (SPM-style workflows)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"critical-checklist-update-rules","dir":"","previous_headings":"","what":"CRITICAL: Checklist Update Rules","title":"neurothresh Development Instructions","text":"MUST UPDATE @fix_plan.md EVERY TASK. optional. Ralph checks @fix_plan.md completion. don’t update , Ralph track progress.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"rules","dir":"","previous_headings":"CRITICAL: Checklist Update Rules","what":"Rules:","title":"neurothresh Development Instructions","text":"starting task: Find @fix_plan.md note status completing task: IMMEDIATELY change [ ] [x] @fix_plan.md Never batch updates: Mark [x] right task, end Never say “complete” “done” @fix_plan.md reflects reality","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"example-workflow","dir":"","previous_headings":"CRITICAL: Checklist Update Rules","what":"Example workflow:","title":"neurothresh Development Instructions","text":"claim completion without updating @fix_plan.md, lying.","code":"1. Read @fix_plan.md, find: - [ ] US-005: Implement score_set() 2. Implement score_set() in R/scoring.R 3. Write test in tests/testthat/test-scoring.R 4. Run: Rscript -e \"devtools::test(filter='scoring')\" 5. IMMEDIATELY edit @fix_plan.md: - [x] US-005: Implement score_set() 6. Move to next task"},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"core-development-loop","dir":"","previous_headings":"","what":"Core Development Loop","title":"neurothresh Development Instructions","text":"Read @fix_plan.md: Find first unchecked [ ] task Implement ONE task: Focus single item Test : Run relevant tests Update @fix_plan.md: Change [ ] [x] task Report status: Include task completion response Repeat tasks [x]","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"algorithm-specifications","dir":"","previous_headings":"Reference Materials (READ THESE)","what":"Algorithm Specifications","title":"neurothresh Development Instructions","text":"docs/discussion/part-01-grf-vs-lrmft.md - Theory, mathematical proofs docs/discussion/part-02-set-indexed-inference.md - T_κ(R) definition, pseudocode docs/discussion/part-03-hierarchical-stepdown.md - R pseudocode, Westfall-Young","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"production-c-code-use-verbatim","dir":"","previous_headings":"Reference Materials (READ THESE)","what":"Production C++ Code (USE VERBATIM)","title":"neurothresh Development Instructions","text":"docs/discussion/part-04-onepass-rcpp.md - One-pass sibling scoring C++ code docs/discussion/part-05-bbox-helpers--baselines.md - bbox helpers, baseline methods CRITICAL: C++ code parts 4 5 production-ready. Copy directly src/*.cpp files.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"library-integration","dir":"","previous_headings":"Reference Materials (READ THESE)","what":"Library Integration","title":"neurothresh Development Instructions","text":"lib_notes.md - neuroim2/neuroatlas API reference","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"required","dir":"","previous_headings":"Dependencies","what":"Required","title":"neurothresh Development Instructions","text":"neuroim2 (>= 0.8.0): Install via remotes::install_github(\"bbuchsbaum/neuroim2\") Rcpp (>= 1.0.0)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"optional","dir":"","previous_headings":"Dependencies","what":"Optional","title":"neurothresh Development Instructions","text":"neuroatlas (>= 0.1.0): Install via remotes::install_github(\"bbuchsbaum/neuroatlas\")","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"code","dir":"","previous_headings":"Quality Standards","what":"Code","title":"neurothresh Development Instructions","text":"C++ uses Rcpp (NumericVector, IntegerVector, List) R functions roxygen2 documentation (@param, @return, @export, @examples) placeholder implementations","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"documentation","dir":"","previous_headings":"Quality Standards","what":"Documentation","title":"neurothresh Development Instructions","text":"Run devtools::document() adding/changing roxygen comments Every exported function needs documentation","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"testing","dir":"","previous_headings":"Quality Standards","what":"Testing","title":"neurothresh Development Instructions","text":"Use testthat framework Run devtools::test() verify Limit testing ~20% effort - focus implementation","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"build-commands","dir":"","previous_headings":"","what":"Build Commands","title":"neurothresh Development Instructions","text":"","code":"# Generate documentation Rscript -e \"devtools::document()\"  # Run tests Rscript -e \"devtools::test()\"  # Full check R CMD check . --no-manual  # Load for development Rscript -e \"devtools::load_all()\""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"completion-verification","dir":"","previous_headings":"","what":"Completion Verification","title":"neurothresh Development Instructions","text":"final response, run: script checks: 1. @fix_plan.md tasks [x] 2. R CMD check 0 errors 0 warnings 3. tests pass 4. exports documented may set EXIT_SIGNAL: true verify_completion.sh outputs “VERIFICATION PASSED”","code":"./verify_completion.sh"},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"status-block-format","dir":"","previous_headings":"","what":"Status Block Format","title":"neurothresh Development Instructions","text":"End EVERY response :","code":"--- TASKS_COMPLETED_THIS_LOOP: [list tasks you marked [x] this loop] @FIX_PLAN_STATUS: [X checked] / [Y total] tasks complete STATUS: [IN_PROGRESS|COMPLETE|BLOCKED] EXIT_SIGNAL: [true|false] ---"},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"exit_signal-rules","dir":"","previous_headings":"Status Block Format","what":"EXIT_SIGNAL Rules","title":"neurothresh Development Instructions","text":"false task @fix_plan.md still [ ] false verify_completion.sh fails true tasks [x] verify_completion.sh passes","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"anti-patterns-do-not-do-these","dir":"","previous_headings":"","what":"Anti-Patterns (DO NOT DO THESE)","title":"neurothresh Development Instructions","text":"❌ Saying “project complete” without @fix_plan.md items checked ❌ Setting EXIT_SIGNAL: true without running verify_completion.sh ❌ Implementing multiple tasks updating @fix_plan.md ❌ Skipping documentation (roxygen2) ❌ Ignoring R CMD check warnings","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/PROMPT.html","id":"file-structure","dir":"","previous_headings":"","what":"File Structure","title":"neurothresh Development Instructions","text":"","code":"neurothresh/ ├── DESCRIPTION ├── NAMESPACE ├── R/ │   ├── neurothresh-package.R │   ├── canonicalize.R │   ├── scoring.R │   ├── octree.R │   ├── permutation.R │   ├── stepdown.R │   ├── hierarchical.R │   ├── hier_scan.R │   ├── rft.R │   ├── tfce.R │   ├── cluster_fdr.R │   └── RcppExports.R ├── src/ │   ├── bbox_helpers.cpp │   ├── split_indices.cpp │   ├── score_children.cpp │   └── RcppExports.cpp ├── tests/testthat/ ├── man/ └── vignettes/"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"what-is-neurothresh","dir":"Articles","previous_headings":"","what":"What is neurothresh?","title":"Introduction to neurothresh","text":"analyzing neuroimaging data, often face fundamental challenge: decide brain regions show real activation versus noise? Traditional approaches like Random Field Theory (RFT) control false positives well, can overly conservative spatially extended activations common task fMRI. neurothresh implements Likelihood-Ratio Matched-Filter Thresholding (LR-MFT), method designed sensitive distributed brain activations still maintaining rigorous error control. key insight instead asking “single voxel significant?”, ask “evidence activation across region?”","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"the-core-idea-aggregating-evidence","dir":"Articles","previous_headings":"","what":"The Core Idea: Aggregating Evidence","title":"Introduction to neurothresh","text":"package provides two complementary ways score brain region: Soft-max score (score_set): Uses temperature parameter κ (kappa) balance detecting focal peaks (high κ) diffuse activation (low κ). Variance-stabilized score (score_set_stabilized): Normalizes region size small large regions can fairly compared. Let’s see work simple example: higher κ values make score sensitive strongest peaks, stabilized U0 score gives fair weight voxels region.","code":"# Simulate 1000 voxels with a \"hot\" region (voxels 400-450) set.seed(42) n_vox <- 1000 z_vec <- rnorm(n_vox) z_vec[400:450] <- z_vec[400:450] + 2.5  # Add signal  # Use uniform prior weights (all voxels contribute equally) pi_vec <- rep(1, n_vox)  # Score just the activated region region_idx <- 400:450  # The stabilized score accounts for region size u0_result <- score_set_stabilized(region_idx, z_vec, pi_vec)  # Soft-max scores with different kappa values s1 <- score_set(region_idx, z_vec, pi_vec, kappa = 1) s2 <- score_set(region_idx, z_vec, pi_vec, kappa = 2)  cat(\"U0 (stabilized):\", round(u0_result$U0, 3), \"\\n\") #> U0 (stabilized): 17.148 cat(\"Effective sample size:\", round(u0_result$n_eff, 1), \"\\n\") #> Effective sample size: 51 cat(\"Soft-max (kappa=1):\", round(s1, 3), \"\\n\") #> Soft-max (kappa=1): 6.8 cat(\"Soft-max (kappa=2):\", round(s2, 3), \"\\n\") #> Soft-max (kappa=2): 10.398"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"multiscale-scanning","dir":"Articles","previous_headings":"","what":"Multiscale Scanning","title":"Introduction to neurothresh","text":"One powerful feature neurothresh multiscale scanning: testing activation multiple spatial scales simultaneously. octree_scan_fwer() function divides brain hierarchical cubes tests one, controlling family-wise error rate (FWER) across tests.","code":"# Create a 3D volume with an embedded signal set.seed(123) z_test <- array(rnorm(20 * 20 * 20), dim = c(20, 20, 20)) z_test[8:12, 8:12, 8:12] <- z_test[8:12, 8:12, 8:12] + 2  # Run the multiscale scan # fwhm_vox specifies the smoothness of the data (in voxels) result <- octree_scan_fwer(z_test, n_perm = 200, null = \"mc_fwhm\",                             fwhm_vox = c(2, 2, 2))  cat(\"Threshold for significance:\", round(result$u, 3), \"\\n\") #> Threshold for significance: 7.802 cat(\"Observed maximum score:\", round(result$M_obs, 3), \"\\n\") #> Observed maximum score: 15.8 cat(\"Significant?\", result$M_obs >= result$u, \"\\n\") #> Significant? TRUE"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"working-with-real-neuroimaging-data","dir":"Articles","previous_headings":"","what":"Working with Real Neuroimaging Data","title":"Introduction to neurothresh","text":"practice, ’ll work NIfTI files loaded via neuroim2. ’s typical workflow:","code":"library(neuroim2) library(neurothresh)  # Load your statistical map (already in Z-scores, or use canonicalize_stat()) z_map <- read_vol(\"zstat1.nii.gz\")  # Optional: provide prior weights (e.g., from a meta-analysis or atlas) prior_map <- read_vol(\"prior.nii.gz\")  # Run hierarchical LR-MFT analysis result <- hier_scan(   z_map,   prior_vol = prior_map,   alpha = 0.05,   kappa = c(0.5, 1.0, 2.0),  # Test multiple scales   n_perm = 1000,   method = \"stepdown\" )  summary(result)"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"converting-different-statistic-types","dir":"Articles","previous_headings":"","what":"Converting Different Statistic Types","title":"Introduction to neurothresh","text":"software outputs Z-scores. Use canonicalize_stat() convert t-statistics p-values:","code":"# From t-statistics (need to specify degrees of freedom) z_from_t <- canonicalize_stat(t_map, stat_type = \"t\", df = 25)  # From -log10(p) values (common in GWAS-style analyses) z_from_p <- canonicalize_stat(neglog10p_map, stat_type = \"neglog10p\")"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"choosing-a-null-model","dir":"Articles","previous_headings":"","what":"Choosing a Null Model","title":"Introduction to neurothresh","text":"critical choice generate null distributions permutation testing. safest approach depends data: subject-level maps (recommended): Use sign-flipping subject level. preserves spatial correlation structure. group map: Use model-based null generation estimated smoothness:","code":"# subject_maps is a list of 3D arrays, one per subject null_gen <- make_null_fun_subject_signflip(subject_maps, seed = 1)  result <- octree_scan_fwer(   null_gen$z_vol,   mask = null_gen$mask,   n_perm = 5000,   null_fun = null_gen$null_fun ) # Estimate smoothness from the map and generate correlated null fields result <- octree_scan_fwer(z_map, n_perm = 2000, null = \"mc_fwhm\")"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"comparison-with-traditional-methods","dir":"Articles","previous_headings":"","what":"Comparison with Traditional Methods","title":"Introduction to neurothresh","text":"neurothresh includes implementations standard neuroimaging thresholding methods, useful benchmarking:","code":"# Random Field Theory peak-level correction rft <- rft_peak_fwer(z_map, fwhm_mm = 8)  # Threshold-Free Cluster Enhancement tfce <- tfce_fwer(z_map, n_perm = 5000)  # Cluster-level FDR fdr <- cluster_fdr(z_map, cluster_thresh = 3.0, q = 0.05)"},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/neurothresh-intro.html","id":"when-to-use-lr-mft","dir":"Articles","previous_headings":"","what":"When to Use LR-MFT","title":"Introduction to neurothresh","text":"LR-MFT particularly well-suited expect: Spatially extended activations spanning multiple voxels Multiple activation foci rather single peak Prior information activations might occur focal, single-peak activations, traditional RFT peak-level inference may perform comparably. simulation-validation vignette demonstrates power comparisons.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/simulation-validation.html","id":"purpose-of-this-vignette","dir":"Articles","previous_headings":"","what":"Purpose of This Vignette","title":"Simulation Validation: FWER and Power","text":"statistical thresholding method must satisfy two requirements: Control false positives: ’s real signal (“null hypothesis”), rarely declare significance. Family-Wise Error Rate (FWER) probability making even one false positive. Detect real signals: real signal, want high statistical power find . vignette runs small simulations verify neurothresh achieves goals. use small grids permutations speed; real analyses use larger values.","code":"library(neurothresh)"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/simulation-validation.html","id":"verifying-fwer-control","dir":"Articles","previous_headings":"","what":"Verifying FWER Control","title":"Simulation Validation: FWER and Power","text":"First, let’s check ’s signal (pure noise), reject 5% time using α = 0.05. ’ll use simple 2D example soft-max score. estimated FWER close 0.05. variation expected due Monte Carlo noise.","code":"# Simulation parameters B <- 200       # Number of null simulations to build threshold n <- 30        # Grid size (30 x 30) kernel <- make_kernel(radius = 2, sigma = 1)  # Step 1: Build null distribution by simulating pure noise null_scores <- numeric(B) for (b in seq_len(B)) {   z <- matrix(rnorm(n * n), nrow = n)   z <- smooth_field(z, kernel)  # Add spatial correlation   null_scores[b] <- softmax_score(z, kappa = 1) }  # Step 2: Set threshold at 95th percentile (for alpha = 0.05) threshold <- quantile(null_scores, probs = 0.95)  # Step 3: Check false positive rate with fresh null samples B2 <- 200 false_positives <- 0 for (b in seq_len(B2)) {   z <- matrix(rnorm(n * n), nrow = n)   z <- smooth_field(z, kernel)   false_positives <- false_positives + (softmax_score(z, kappa = 1) >= threshold) }  fwer_estimate <- false_positives / B2 cat(\"Estimated FWER:\", fwer_estimate, \"\\n\") #> Estimated FWER: 0.045 cat(\"Expected (alpha = 0.05):\", 0.05, \"\\n\") #> Expected (alpha = 0.05): 0.05"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/simulation-validation.html","id":"power-comparison-soft-max-vs-peak-maximum","dir":"Articles","previous_headings":"","what":"Power Comparison: Soft-max vs Peak Maximum","title":"Simulation Validation: FWER and Power","text":"Now let’s compare two approaches detecting spatially extended signal: Soft-max score: Aggregates evidence across entire field Peak maximum: looks single highest voxel signal spread across multiple voxels (“blob”), soft-max higher power accumulates evidence. soft-max typically shows higher power blob-shaped signal pools evidence across activated region.","code":"B <- 200 amp <- 1.5                    # Signal amplitude center <- c(15, 15)           # Center of the blob  # We already have the soft-max threshold from above thr_soft <- threshold  # Build null distribution for peak maximum thr_max <- quantile(replicate(B, {   z <- smooth_field(matrix(rnorm(n * n), nrow = n), kernel)   max(z) }), probs = 0.95)  # Now test power: how often do we detect the blob? power_soft <- 0 power_max <- 0  for (b in seq_len(B)) {   # Generate noise + blob signal   z <- smooth_field(matrix(rnorm(n * n), nrow = n), kernel)   z <- insert_blob(z, center, radius = 2, amp = amp)    # Test both methods   power_soft <- power_soft + (softmax_score(z, kappa = 1) >= thr_soft)   power_max <- power_max + (max(z) >= thr_max) }  results <- c(softmax = power_soft / B, peak_max = power_max / B) cat(\"Power comparison:\\n\") #> Power comparison: cat(\"  Soft-max:\", results[\"softmax\"], \"\\n\") #>   Soft-max: NA cat(\"  Peak max:\", results[\"peak_max\"], \"\\n\") #>   Peak max: NA"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/simulation-validation.html","id":"d-octree-scanning","dir":"Articles","previous_headings":"","what":"3D Octree Scanning","title":"Simulation Validation: FWER and Power","text":"octree_scan_fwer() function applies similar principles 3D, using hierarchical decomposition. ’s quick check runs correctly:","code":"set.seed(1) z_null <- array(rnorm(20 * 20 * 20), dim = c(20, 20, 20))  # Run with correlated null model res <- octree_scan_fwer(   z_null,   n_perm = 100,   null = \"mc_fwhm\",   fwhm_vox = c(2, 2, 2) )  cat(\"Threshold:\", round(res$u, 3), \"\\n\") #> Threshold: 7.836 cat(\"Observed score:\", round(res$M_obs, 3), \"\\n\") #> Observed score: 3.81 cat(\"Rejected (should usually be FALSE for null data):\", res$M_obs >= res$u, \"\\n\") #> Rejected (should usually be FALSE for null data): FALSE"},{"path":"https://bbuchsbaum.github.io/neurothresh/articles/simulation-validation.html","id":"practical-recommendations","dir":"Articles","previous_headings":"","what":"Practical Recommendations","title":"Simulation Validation: FWER and Power","text":"toy examples use small grids permutations demonstration. real neuroimaging analyses: Use least 1000-5000 permutations stable thresholds possible, use subject-level resampling (make_null_fun_subject_signflip) rather model-based null generation mc_fwhm null model assumes stationary Gaussian smoothness, approximate real brain data; long-tailed ACF parameters upstream tools, consider null = \"mc_acf\" acf_params","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Brad Buchsbaum. Author, maintainer.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Buchsbaum B (2026). neurothresh: Neuroimaging Statistical Thresholding LR-MFT. R package version 0.1.0, https://github.com/bbuchsbaum/neurothresh.","code":"@Manual{,   title = {neurothresh: Neuroimaging Statistical Thresholding with LR-MFT},   author = {Brad Buchsbaum},   year = {2026},   note = {R package version 0.1.0},   url = {https://github.com/bbuchsbaum/neurothresh}, }"},{"path":[]},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"package-overview","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"Package Overview","title":"Library Notes for neurothresh Development","text":"Version: 0.8.3 Purpose: Data structures /O volumetric brain imaging (focus fMRI) Architecture: S4 OOP Rcpp performance-critical operations Core Dependencies: Matrix, RNifti, Rcpp, RcppParallel","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"clusteredneurovol-critical","dir":"","previous_headings":"neuroim2 Library (Primary Dependency) > Key Data Structures for neurothresh","what":"ClusteredNeuroVol (CRITICAL)","title":"Library Notes for neurothresh Development","text":"primary data structure parcellations. Located R/clustervol.R R/all_class.R (lines 816-884). Slots: - mask: LogicalNeuroVol - spatial domain clusters (TRUE = included) - clusters: integer vector - cluster ID masked voxel - label_map: named list - cluster ID → human-readable label mapping - cluster_map: environment - cluster ID → voxel indices (O(1) lookup) - Inherits data (sparseVector) SparseNeuroVol Constructor: Key Methods: - num_clusters(x) - number clusters - centroids(x, type=\"center_of_mass\"|\"medoid\") - cluster centers - split_clusters(x) - returns deflist ROIVol objects - .array(x) - convert dense 3D array Companion 4D Class: ClusteredNeuroVec - Aggregates 4D data cluster using reduction function - Stores T × K matrix (timepoints × clusters) instead full voxel data - Constructor: ClusteredNeuroVec(x, cvol, FUN=mean, weights=NULL)","code":"ClusteredNeuroVol(mask, clusters, label_map=NULL, label=\"\")"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"volume-class-hierarchy","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"Volume Class Hierarchy","title":"Library Notes for neurothresh Development","text":"DenseNeuroVol: Full 3D array, efficient random access SparseNeuroVol: Matrix::sparseVector, memory-efficient sparse data LogicalNeuroVol: Binary masks, extends DenseNeuroVol","code":"NeuroObj (base: has @space slot)   └── NeuroVol (3D volumes)       ├── DenseNeuroVol (dense array storage)       │   └── LogicalNeuroVol (binary masks)       ├── SparseNeuroVol (sparse vector storage)       │   └── ClusteredNeuroVol (partitioned clusters)       └── IndexLookupVol (index mapping for sparse access)"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"neurospace-coordinate-system","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"NeuroSpace (Coordinate System)","title":"Library Notes for neurothresh Development","text":"Core spatial reference neuroimaging objects. Slots: - dim: integer - grid dimensions - origin: numeric - world coordinates first voxel - spacing: numeric - voxel physical sizes (mm) - axes: AxisSet - anatomical orientation - trans: 4×4 matrix - voxel→world transformation - inverse: 4×4 matrix - world→voxel transformation Key Conversion Functions: - index_to_grid(x, idx) - linear index → (,j,k) - grid_to_index(x, coords) - (,j,k) → linear index - coord_to_grid(x, coords) - world → voxel - grid_to_coord(x, coords) - voxel → world","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"id_4d-time-series-neurovec","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"4D Time Series (NeuroVec)","title":"Library Notes for neurothresh Development","text":"Key Methods: - series(x, , j, k) - extract time series voxel - series(x, coords_matrix) - extract multiple time series - sub_vector(x, timepoints) - temporal subset - x[[t]] - extract single timepoint NeuroVol 5D Data: NeuroHyperVec - Dimensions: [features × trials × voxels] - multi-basis analyses, spectral decompositions","code":"NeuroVec (base 4D class)   ├── DenseNeuroVec (dense 4D array)   ├── SparseNeuroVec (sparse: timepoints × masked_voxels matrix)   ├── MappedNeuroVec (memory-mapped)   ├── FileBackedNeuroVec (on-demand file loading)   ├── BigNeuroVec (bigstatsr::FBM for large data)   └── NeuroVecSeq (sequence of variable-length NeuroVecs)"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"roi-region-of-interest-classes","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"ROI (Region of Interest) Classes","title":"Library Notes for neurothresh Development","text":"ROI Creation Functions: - spherical_roi(bvol, centroid, radius) → ROIVolWindow - spherical_roi_set(bvol, centroids, radius) → list ROIs - cuboid_roi(bvol, centroid, surround) → ROIVolWindow - square_roi(bvol, centroid, surround, fixdim) → 2D ROI Key Methods: - coords(x, real=FALSE) - extract coordinates - indices(x) - convert linear indices - values(x) - get data values - series_roi(vec, coords) → ROIVec","code":"ROI (virtual base)   └── ROICoords (just coordinates)       └── ROIVol (coords + values)           └── ROIVolWindow (centered ROI, e.g., searchlight)   └── ROIVec (4D: coords + time series matrix)       └── ROIVecWindow (centered 4D ROI)"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"io-functions","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"I/O Functions","title":"Library Notes for neurothresh Development","text":"read_vol(filename) - read 3D NIfTI/AFNI read_vec(filename, mode=\"mmap\"|\"bigvec\") - read 4D write_vol(vol, filename) - write 3D write_vec(vec, filename) - write 4D","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"useful-processing-functions","dir":"","previous_headings":"neuroim2 Library (Primary Dependency)","what":"Useful Processing Functions","title":"Library Notes for neurothresh Development","text":"conn_comp(vol) - connected component labeling resample(vol, outspace, interp) - spatial resampling gaussian_blur(vol, sigma) - smoothing searchlight(vol, radius, fun) - searchlight analysis","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"package-overview-1","dir":"","previous_headings":"neuroatlas Library (Secondary Dependency)","what":"Package Overview","title":"Library Notes for neurothresh Development","text":"Version: 0.1.0 Purpose: Unified interface brain atlases parcellations Integration: Returns ClusteredNeuroVol neuroim2","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"available-atlases","dir":"","previous_headings":"neuroatlas Library (Secondary Dependency)","what":"Available Atlases","title":"Library Notes for neurothresh Development","text":"Convenience: sy_200_7(), sy_400_17(), etc.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"atlas-object-structure","dir":"","previous_headings":"neuroatlas Library (Secondary Dependency)","what":"Atlas Object Structure","title":"Library Notes for neurothresh Development","text":"","code":"atlas <- list(   name = \"Schaefer-300-7networks\",   atlas = ClusteredNeuroVol(...),  # The volume   ids = integer_vector,            # Region IDs   labels = character_vector,       # Short names   orig_labels = character_vector,  # Full original names   hemi = c(\"left\", \"right\", ...),  # Hemisphere   network = c(\"Vis\", \"SomMot\",...),# Network assignment (Schaefer)   cmap = data.frame(red, green, blue),  # Colors 0-255   roi_metadata = tibble(...)       # Tidy metadata ) class(atlas) <- c(\"schaefer\", \"volatlas\", \"atlas\")"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"key-functions","dir":"","previous_headings":"neuroatlas Library (Secondary Dependency)","what":"Key Functions","title":"Library Notes for neurothresh Development","text":"Access & Metadata: - roi_metadata(atlas) → tibble id, label, hemi, network, colors - filter_atlas(atlas, condition) → filtered atlas - get_roi(atlas, label|id, hemi) → list ROIVol Analysis: - reduce_atlas(atlas, data, FUN) → region-wise summary stats - map_atlas(atlas, vals, thresh) → map values regions - merge_atlases(atlas1, atlas2) → combined atlas - dilate_atlas(atlas, mask, radius) → expand parcels Templates (via TemplateFlow): - get_template(space, suffix) - standard templates - get_template_brainmask() - brain mask","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"working-with-parcellations","dir":"","previous_headings":"Key Integration Points for neurothresh","what":"Working with Parcellations","title":"Library Notes for neurothresh Development","text":"","code":"# Load atlas atlas <- neuroatlas::get_schaefer_atlas(parcels=\"200\", networks=\"7\")  # Extract ClusteredNeuroVol cvol <- atlas$atlas  # Get number of parcels k <- neuroim2::num_clusters(cvol)  # Split into ROIs rois <- neuroim2::split_clusters(cvol)  # Extract parcel indices for parcel k indices_k <- cvol@cluster_map[[as.character(k)]]  # Convert parcel to mask parcel_mask <- neuroim2::as.logical(rois[[k]])"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"reducing-4d-data-by-parcels","dir":"","previous_headings":"Key Integration Points for neurothresh","what":"Reducing 4D Data by Parcels","title":"Library Notes for neurothresh Development","text":"","code":"# Load 4D fMRI vec <- neuroim2::read_vec(\"fmri.nii\")  # Create clustered representation (parcel-wise means) cvec <- neuroim2::ClusteredNeuroVec(vec, cvol, FUN=mean)  # Access T × K matrix ts_matrix <- as.matrix(cvec)"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"spatial-operations","dir":"","previous_headings":"Key Integration Points for neurothresh","what":"Spatial Operations","title":"Library Notes for neurothresh Development","text":"","code":"# Get parcel centroids cents <- neuroim2::centroids(cvol, type=\"center_of_mass\")  # Create spherical ROI around centroid roi <- neuroim2::spherical_roi(cvol, cents[1,], radius=6)  # Extract time series from ROI roi_ts <- neuroim2::series(vec, neuroim2::coords(roi))"},{"path":"https://bbuchsbaum.github.io/neurothresh/lib_notes.html","id":"summary-for-neurothresh-implementation","dir":"","previous_headings":"","what":"Summary for neurothresh Implementation","title":"Library Notes for neurothresh Development","text":"Primary Classes: 1. ClusteredNeuroVol - parcellation representation 2. ClusteredNeuroVec - parcel-aggregated 4D data 3. NeuroSpace - coordinate system management 4. ROIVol - individual region extraction Key Operations: - Parcel extraction via split_clusters() cluster_map environment - Time series extraction via series() ClusteredNeuroVec - Coordinate mapping via grid_to_index() / index_to_grid() - Atlas loading via neuroatlas functions Performance Considerations: - ClusteredNeuroVol sparse - memory efficient parcellations - cluster_map environment provides O(1) lookup cluster ID - Use SparseNeuroVec masked 4D data save memory - C++ implementations available heavy computation (Rcpp)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/bbox_from_indices.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute bounding box from mask-space indices — bbox_from_indices","title":"Compute bounding box from mask-space indices — bbox_from_indices","text":"Compute bounding box mask-space indices","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/bbox_from_indices.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute bounding box from mask-space indices — bbox_from_indices","text":"","code":"bbox_from_indices(idx, x, y, z)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/bbox_from_indices.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute bounding box from mask-space indices — bbox_from_indices","text":"idx Integer vector 1-based mask-space indices x Integer vector x coordinates (mask-space) y Integer vector y coordinates (mask-space) z Integer vector z coordinates (mask-space)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/bbox_from_indices.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute bounding box from mask-space indices — bbox_from_indices","text":"Integer vector length 6: (x0, x1, y0, y1, z0, z1)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":null,"dir":"Reference","previous_headings":"","what":"Canonicalize statistical maps to Z-scores — canonicalize_stat","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"Converts various statistical map types (Z-scores, t-statistics, -log10(p) values) common Z-score representation unified thresholding procedures.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"","code":"canonicalize_stat(   stat_vol,   stat_type = c(\"Z\", \"t\", \"neglog10p\"),   df = NULL,   tail = c(\"pos\", \"neg\", \"two\"),   p_side = c(\"one\", \"two\"),   sign_vol = NULL )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"stat_vol NeuroVol object containing statistical map stat_type Character string specifying input type: \"Z\" Z-scores (identity transform) \"t\" t-statistics (requires df) \"neglog10p\" Negative log10 p-values df Degrees freedom, required stat_type = \"t\" tail Character string specifying tail: \"pos\" Positive tail (activations) \"neg\" Negative tail (deactivations) \"two\" Two-sided test p_side Character string -log10(p) inputs specifying whether p-values one-sided two-sided: \"one\" \"two\" sign_vol Optional NeuroVol providing sign information -log10(p) inputs recover directionality","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"list components: Zeq NeuroVol equivalent Z-scores p_one NeuroVol one-sided p-values p_two NeuroVol two-sided p-values mask Logical mask valid voxels","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"conversions : Z-scores: Used directly t-statistics: Converted via qnorm(pt(t, df)) -log10(p): Converted via qnorm(1 - 10^(-x)) optional sign recovery sign_vol","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/canonicalize_stat.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Canonicalize statistical maps to Z-scores — canonicalize_stat","text":"","code":"if (FALSE) { # \\dontrun{ # From t-statistics with 50 degrees of freedom result <- canonicalize_stat(t_map, stat_type = \"t\", df = 50)  # From -log10(p) with sign information result <- canonicalize_stat(logp_map, stat_type = \"neglog10p\",                             sign_vol = t_map) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster-fdr.html","id":null,"dir":"Reference","previous_headings":"","what":"Cluster-Level FDR Control — cluster-fdr","title":"Cluster-Level FDR Control — cluster-fdr","text":"Implements topological FDR control cluster level using Benjamini-Hochberg procedure applied cluster p-values.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":null,"dir":"Reference","previous_headings":"","what":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"Controls False Discovery Rate cluster level applying Benjamini-Hochberg procedure cluster-extent p-values.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"","code":"cluster_fdr(   stat_vol,   mask = NULL,   cluster_thresh = 3,   q = 0.05,   p_method = c(\"rft\", \"perm\"),   fwhm_mm = NULL,   n_perm = 5000,   tail = c(\"pos\", \"neg\", \"two\"),   two_sided_policy = c(\"BH_all\", \"split_q\"),   seed = NULL )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"stat_vol NeuroVol containing statistic map mask Optional LogicalNeuroVol analysis domain cluster_thresh Cluster-forming threshold (Z-score) q FDR level (default 0.05) p_method Method computing cluster p-values: \"rft\" (Random Field Theory) \"perm\" (permutation) fwhm_mm Smoothness mm (required p_method = \"rft\") n_perm Number permutations (p_method = \"perm\") tail \"pos\", \"neg\", \"two\" two_sided_policy two-sided: \"BH_all\" (pool tails) \"split_q\" (q/2 per tail) seed Random seed permutation","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"List components: sig_mask Logical mask FDR-significant clusters table Data frame cluster statistics n_clusters Number significant clusters","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"implements \"topological FDR\" advocated Chumbley & Friston, FDR controlled finite set clusters rather voxels.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"Chumbley, J. R., & Friston, K. J. (2009). False discovery rate revisited: FDR topological inference using Gaussian random fields. NeuroImage, 44(1), 62-70.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/cluster_fdr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Cluster-FDR with RFT or Permutation P-values — cluster_fdr","text":"","code":"if (FALSE) { # \\dontrun{ # RFT-based cluster FDR result <- cluster_fdr(z_map, cluster_thresh = 3.0, q = 0.05,                       p_method = \"rft\", fwhm_mm = 8)  # Permutation-based cluster FDR result <- cluster_fdr(z_map, cluster_thresh = 3.0, q = 0.05,                       p_method = \"perm\", n_perm = 5000) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-array_to_vol.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert array to vol-like object (placeholder) — .array_to_vol","title":"Convert array to vol-like object (placeholder) — .array_to_vol","text":"Convert array vol-like object (placeholder)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-array_to_vol.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert array to vol-like object (placeholder) — .array_to_vol","text":"","code":".array_to_vol(vals, dims, template)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-bh_reject.html","id":null,"dir":"Reference","previous_headings":"","what":"Benjamini-Hochberg rejection — .bh_reject","title":"Benjamini-Hochberg rejection — .bh_reject","text":"Benjamini-Hochberg rejection","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-bh_reject.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Benjamini-Hochberg rejection — .bh_reject","text":"","code":".bh_reject(p, q)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_fdr_twosided.html","id":null,"dir":"Reference","previous_headings":"","what":"Two-sided cluster FDR — .cluster_fdr_twosided","title":"Two-sided cluster FDR — .cluster_fdr_twosided","text":"Two-sided cluster FDR","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_fdr_twosided.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Two-sided cluster FDR — .cluster_fdr_twosided","text":"","code":".cluster_fdr_twosided(   stat_vol,   mask,   cluster_thresh,   q,   p_method,   fwhm_mm,   n_perm,   two_sided_policy,   seed )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_pvals_perm.html","id":null,"dir":"Reference","previous_headings":"","what":"Permutation cluster p-values — .cluster_pvals_perm","title":"Permutation cluster p-values — .cluster_pvals_perm","text":"Permutation cluster p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_pvals_perm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Permutation cluster p-values — .cluster_pvals_perm","text":"","code":".cluster_pvals_perm(z, mask, u0, obs_clusters, n_perm, seed)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_pvals_rft.html","id":null,"dir":"Reference","previous_headings":"","what":"RFT cluster p-values — .cluster_pvals_rft","title":"RFT cluster p-values — .cluster_pvals_rft","text":"RFT cluster p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-cluster_pvals_rft.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"RFT cluster p-values — .cluster_pvals_rft","text":"","code":".cluster_pvals_rft(sizes, u0, fwhm_mm, vox_size)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-find_clusters.html","id":null,"dir":"Reference","previous_headings":"","what":"Find connected components (simple 6-connectivity) — .find_clusters","title":"Find connected components (simple 6-connectivity) — .find_clusters","text":"Find connected components (simple 6-connectivity)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-find_clusters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find connected components (simple 6-connectivity) — .find_clusters","text":"","code":".find_clusters(binary_mask, dims)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-get_neighbors_6.html","id":null,"dir":"Reference","previous_headings":"","what":"Get 6-connected neighbors — .get_neighbors_6","title":"Get 6-connected neighbors — .get_neighbors_6","text":"Get 6-connected neighbors","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-get_neighbors_6.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get 6-connected neighbors — .get_neighbors_6","text":"","code":".get_neighbors_6(idx, dims)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-score_parcels_vec.html","id":null,"dir":"Reference","previous_headings":"","what":"Vectorized parcel scoring — .score_parcels_vec","title":"Vectorized parcel scoring — .score_parcels_vec","text":"Vectorized parcel scoring","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-score_parcels_vec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Vectorized parcel scoring — .score_parcels_vec","text":"","code":".score_parcels_vec(z_vec, pi_vec, lab_vec, log_den1, inv_sqrt_den2, kappa_grid)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-tfce_from_vec.html","id":null,"dir":"Reference","previous_headings":"","what":"TFCE from vector (internal helper) — .tfce_from_vec","title":"TFCE from vector (internal helper) — .tfce_from_vec","text":"TFCE vector (internal helper)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-tfce_from_vec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"TFCE from vector (internal helper) — .tfce_from_vec","text":"","code":".tfce_from_vec(z_vec, dims, mask, H, E, dh, tail)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-tfce_fwer_twosided.html","id":null,"dir":"Reference","previous_headings":"","what":"Two-sided TFCE with combined max null — .tfce_fwer_twosided","title":"Two-sided TFCE with combined max null — .tfce_fwer_twosided","text":"Two-sided TFCE combined max null","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/dot-tfce_fwer_twosided.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Two-sided TFCE with combined max null — .tfce_fwer_twosided","text":"","code":".tfce_fwer_twosided(stat_vol, mask, n_perm, H, E, dh, alpha, seed)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/estimate_fwhm_vox.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","title":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","text":"Map-smoothness estimator based robust sign correlations short lags. assumes approximate stationarity signal occupies relatively small fraction mask.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/estimate_fwhm_vox.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","text":"","code":"estimate_fwhm_vox(   z_vol,   mask = NULL,   clip = 3,   isotropic = FALSE,   z_trim = 1.5 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/estimate_fwhm_vox.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","text":"z_vol 3D volume-like object. mask Optional logical mask aligned z_vol. NULL, uses .finite(.numeric(z_vol)). clip Clip value applied z_vol prior taking sign, reduce sensitivity large outliers (default 3). isotropic Logical; TRUE, returns single averaged FWHM replicated x/y/z. z_trim NULL, restricts estimation voxels |Z| <= z_trim (default 1.5) heuristic reduce contamination true signal single statistic map available.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/estimate_fwhm_vox.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","text":"Numeric vector length 3: estimated fwhm_vox voxel units.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/estimate_fwhm_vox.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Estimate Gaussian ACF FWHM from a single map (map-only) — estimate_fwhm_vox","text":"estimates effective stationary smoothness parameter statistic field (residuals). intended model-based Monte Carlo calibration subject-level/residual resampling available.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/fwer_p_from_maxnull.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute adjusted p-values from max null distribution — fwer_p_from_maxnull","title":"Compute adjusted p-values from max null distribution — fwer_p_from_maxnull","text":"Helper function compute FWER-corrected p-values given max null distribution.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/fwer_p_from_maxnull.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute adjusted p-values from max null distribution — fwer_p_from_maxnull","text":"","code":"fwer_p_from_maxnull(observed, max_null)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/fwer_p_from_maxnull.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute adjusted p-values from max null distribution — fwer_p_from_maxnull","text":"observed Numeric vector observed values max_null Numeric vector max statistics null","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/fwer_p_from_maxnull.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute adjusted p-values from max null distribution — fwer_p_from_maxnull","text":"Numeric vector adjusted p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate null distribution via sign-flipping — generate_null_scores","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"Generates null scores regions randomly sign-flipping Z-score map. valid original data symmetric around zero null (e.g., group difference maps).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"","code":"generate_null_scores(   z_vec,   pi_vec,   regions,   n_perm,   kappa_grid = c(0.5, 1, 2),   seed = NULL )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"z_vec Numeric vector Z-scores (mask-space) pi_vec Numeric vector prior weights (mask-space) regions List index vectors defining regions n_perm Number permutations kappa_grid Numeric vector positive kappa values seed Random seed reproducibility (optional)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"Matrix dimension (n_perm x n_regions) null scores","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"permutation, random sign (+1 -1) drawn independently voxel multiplied Z-scores. omnibus score (max U_0 best S_kappa) computed region.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate null distribution via sign-flipping — generate_null_scores","text":"","code":"if (FALSE) { # \\dontrun{ z_vec <- rnorm(1000) pi_vec <- rep(1, 1000) regions <- list(1:100, 101:200, 201:300) null_matrix <- generate_null_scores(z_vec, pi_vec, regions,                                     n_perm = 1000) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores_parcels.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","title":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","text":"Vectorized null score generation parcels using efficient group-wise operations.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores_parcels.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","text":"","code":"generate_null_scores_parcels(   z_vec,   pi_vec,   lab_vec,   n_perm,   kappa_grid = c(0.5, 1, 2),   seed = NULL )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores_parcels.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","text":"z_vec Numeric vector Z-scores (mask-space) pi_vec Numeric vector prior weights (mask-space) lab_vec Integer vector parcel labels (mask-space) n_perm Number permutations kappa_grid Numeric vector positive kappa values seed Random seed reproducibility (optional)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores_parcels.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","text":"Matrix dimension (n_perm x n_parcels) null scores","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/generate_null_scores_parcels.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Generate null scores for parcel-level analysis — generate_null_scores_parcels","text":"efficient generate_null_scores parcel-level analysis uses vectorized group operations (rowsum) instead looping regions.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend.html","id":null,"dir":"Reference","previous_headings":"","what":"Test a tree of regions with alpha-spending — hier_descend","title":"Test a tree of regions with alpha-spending — hier_descend","text":"Recursive function tests children parent rejected, alpha budget allocated proportionally prior mass.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test a tree of regions with alpha-spending — hier_descend","text":"","code":"hier_descend(   idx_parent,   bbox,   alpha_budget,   z_vec,   pi_vec,   x,   y,   z,   perm_fun,   n_perm,   kappa_grid,   gamma = 0.5,   min_alpha = 1e-06,   min_voxels = 8 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test a tree of regions with alpha-spending — hier_descend","text":"idx_parent Integer vector parent mask-space indices bbox Integer vector length 6 parent bounding box alpha_budget Alpha budget subtree z_vec Numeric vector Z-scores (mask-space) pi_vec Numeric vector prior weights (mask-space) x, y, z Integer vectors coordinates (mask-space) perm_fun Function takes permutation index returns Z vector n_perm Number permutations kappa_grid Numeric vector positive kappa values gamma Fraction alpha testing level (default 0.5) min_alpha Minimum alpha continue testing (default 1e-6) min_voxels Minimum region size test (default 8)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test a tree of regions with alpha-spending — hier_descend","text":"List discovered regions scores p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend_alpha.html","id":null,"dir":"Reference","previous_headings":"","what":"Alpha-spending hierarchical descent without step-down — hier_descend_alpha","title":"Alpha-spending hierarchical descent without step-down — hier_descend_alpha","text":"Tests node permutation distribution descends node significant allocated alpha.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend_alpha.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Alpha-spending hierarchical descent without step-down — hier_descend_alpha","text":"","code":"hier_descend_alpha(   idx_parent,   bbox,   alpha_budget,   z_vec,   pi_vec,   x,   y,   z,   perm_fun,   n_perm,   kappa_grid,   gamma = 0.5,   min_alpha = 1e-06,   min_voxels = 8 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend_alpha.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Alpha-spending hierarchical descent without step-down — hier_descend_alpha","text":"idx_parent Integer vector parent mask-space indices bbox Integer vector length 6 parent bounding box alpha_budget Alpha budget subtree z_vec Numeric vector Z-scores (mask-space) pi_vec Numeric vector prior weights (mask-space) x, y, z Integer vectors coordinates (mask-space) perm_fun Function takes permutation index returns Z vector n_perm Number permutations kappa_grid Numeric vector positive kappa values gamma Fraction alpha testing level (default 0.5) min_alpha Minimum alpha continue testing (default 1e-6) min_voxels Minimum region size test (default 8)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_descend_alpha.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Alpha-spending hierarchical descent without step-down — hier_descend_alpha","text":"List discovered regions scores p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":null,"dir":"Reference","previous_headings":"","what":"Hierarchical LR-MFT Analysis — hier_scan","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"Main entry point hierarchical likelihood-ratio matched-filter thresholding stepdown inference.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"","code":"hier_scan(   z_vol,   prior_vol = NULL,   parcels = NULL,   mask = NULL,   alpha = 0.05,   kappa = c(0.5, 1, 2),   n_perm = 1000,   method = c(\"stepdown\", \"hierarchical\"),   gamma = 0.5,   gamma_root = 0.5,   min_voxels = 8,   min_alpha = 1e-06,   seed = NULL,   stat_type = \"Z\",   df = NULL,   two_sided = FALSE,   prior_eta = 0.9 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"z_vol NeuroVol object containing Z-scores (stat type) prior_vol Optional NeuroVol prior weights. NULL, uniform priors used. parcels Optional ClusteredNeuroVol neuroatlas parcel-based initialization. NULL, starts whole brain octree descent. mask Optional LogicalNeuroVol defining analysis domain. NULL, uses finite voxels z_vol. alpha Significance level FWER control (default 0.05) kappa Temperature parameter(s) soft-max. Can single value vector values search . n_perm Number permutations null distribution (default 1000) method Inference method: \"stepdown\" (Westfall-Young) \"hierarchical\" (alpha-spending ) gamma Fraction alpha testing hierarchical level gamma_root Fraction alpha root/parcel level testing (used stepdown ; hierarchical mode used gamma) min_voxels Minimum region size octree descent min_alpha Minimum alpha continue hierarchical testing seed Random seed reproducibility stat_type Input statistic type: \"Z\", \"t\", \"neglog10p\" df Degrees freedom (required stat_type = \"t\") two_sided Logical, whether perform two-sided inference prior_eta Mixing weight prior smoothing uniform mass. Values [0, 1], 0 uniform 1 raw prior.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"S3 object class \"neurothresh_result\" containing: significant_regions List significant region index vectors tree Hierarchical tree structure scores p-values parcel_results Results parcel-level testing (used) method Method used params Parameters used","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"analysis proceeds follows: Canonicalize input Z-scores parcels provided, test parcels Westfall-Young step-significant parcels (whole brain), descend octree level, test children step-, spend alpha budget Collect significant regions","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hier_scan.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Hierarchical LR-MFT Analysis — hier_scan","text":"","code":"if (FALSE) { # \\dontrun{ library(neuroim2) library(neuroatlas)  # Load statistical map z_map <- read_vol(\"zstat1.nii.gz\")  # Run with default settings result <- hier_scan(z_map, alpha = 0.05, n_perm = 1000)  # With parcellation priors atlas <- get_schaefer_atlas(parcels = \"200\", networks = \"7\") result <- hier_scan(z_map, parcels = atlas$atlas)  # Summary and visualization summary(result) plot(result, z_map) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/hierarchical.html","id":null,"dir":"Reference","previous_headings":"","what":"Hierarchical Testing with Alpha-Spending — hierarchical","title":"Hierarchical Testing with Alpha-Spending — hierarchical","text":"Implements top-hierarchical testing alpha-spending multi-scale inference.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_null_fun_subject_signflip.html","id":null,"dir":"Reference","previous_headings":"","what":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","title":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","text":"Constructs observed Z-equivalent group map null_fun(b) generates sign-flip randomizations flipping subject map single \\(\\pm 1\\) (constant across voxels). preserves spatial covariance structure within subject map recommended way drive resampling-based inference regional statistics.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_null_fun_subject_signflip.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","text":"","code":"make_null_fun_subject_signflip(   subject_vols,   mask = NULL,   seed = NULL,   z_equiv = TRUE )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_null_fun_subject_signflip.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","text":"subject_vols List subject-level 3D volumes (arrays NeuroVols) identical dimensions. mask Optional logical mask aligned volumes. NULL, uses finite voxels common subjects. seed Optional RNG seed. z_equiv TRUE (default), returns Z-equivalent vectors using normal approximation one-sample t statistic df = n_subjects - 1.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_null_fun_subject_signflip.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","text":"list components: z_vol Observed group Z-equivalent volume (array-like, dims). mask Logical mask used. null_fun Function function(b) returning length-n_mask Z-equivalent vector permutation index b. df Degrees freedom used t--Z conversion.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_null_fun_subject_signflip.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Subject-level sign-flip null generator (one-sample) — make_null_fun_subject_signflip","text":"","code":"subj <- replicate(10, array(rnorm(20 * 20 * 20), dim = c(20, 20, 20)), simplify = FALSE) sf <- make_null_fun_subject_signflip(subj, seed = 1) res <- octree_scan_fwer(sf$z_vol, mask = sf$mask, n_perm = 200, null_fun = sf$null_fun)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_perm_fun.html","id":null,"dir":"Reference","previous_headings":"","what":"Create permutation function for hierarchical analysis — make_perm_fun","title":"Create permutation function for hierarchical analysis — make_perm_fun","text":"Creates function returns sign-flipped Z vectors use hierarchical descent.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_perm_fun.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create permutation function for hierarchical analysis — make_perm_fun","text":"","code":"make_perm_fun(z_vec, n_perm, seed = NULL)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_perm_fun.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create permutation function for hierarchical analysis — make_perm_fun","text":"z_vec Numeric vector Z-scores (mask-space) n_perm Number permutations seed Random seed reproducibility (optional)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_perm_fun.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create permutation function for hierarchical analysis — make_perm_fun","text":"function takes permutation index b (1 n_perm) returns sign-flipped Z vector","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/make_perm_fun.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create permutation function for hierarchical analysis — make_perm_fun","text":"sign matrix pre-generated stored, calling returned function multiple times index gives result.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/maxT_singlestep.html","id":null,"dir":"Reference","previous_headings":"","what":"Single-step MaxT Procedure — maxT_singlestep","title":"Single-step MaxT Procedure — maxT_singlestep","text":"Implements single-step maxT procedure FWER control. Less powerful step-simpler.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/maxT_singlestep.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Single-step MaxT Procedure — maxT_singlestep","text":"","code":"maxT_singlestep(observed, null_matrix, alpha = 0.05)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/maxT_singlestep.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Single-step MaxT Procedure — maxT_singlestep","text":"observed Numeric vector observed test statistics null_matrix Matrix null statistics (n_perm x n_tests) alpha Significance level (default 0.05)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/maxT_singlestep.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Single-step MaxT Procedure — maxT_singlestep","text":"data.frame columns: region Index region score Observed test statistic p_adj Adjusted p-value rejected Logical, whether null rejected","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/neurothresh-package.html","id":null,"dir":"Reference","previous_headings":"","what":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","title":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","text":"Statistical thresholding neuroimaging data using Likelihood-Ratio Matched-Filter Thresholding (LR-MFT) hierarchical stepdown inference. Provides theoretically superior alternative traditional GRF/RFT methods detecting spatially extended activations. Includes baseline implementations (RFT, TFCE, cluster-FDR) comparison. Statistical thresholding neuroimaging data using Likelihood-Ratio Matched-Filter Thresholding (LR-MFT) hierarchical stepdown inference.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/neurothresh-package.html","id":"main-functions","dir":"Reference","previous_headings":"","what":"Main Functions","title":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","text":"hier_scan Main entry point hierarchical LR-MFT analysis score_set Compute prior-weighted statistic T_kappa(R) canonicalize_stat Convert Z/t/neglog10p Z-scores","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/neurothresh-package.html","id":"baseline-methods","dir":"Reference","previous_headings":"","what":"Baseline Methods","title":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","text":"rft_peak_fwer RFT peak-level FWER rft_cluster_fwer RFT cluster-level FWER tfce_transform TFCE transformation tfce_fwer TFCE permutation FWER cluster_fdr Topological cluster-FDR","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/neurothresh-package.html","id":"key-concepts","dir":"Reference","previous_headings":"","what":"Key Concepts","title":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","text":"LR-MFT provably powerful traditional GRF/RFT methods detecting spatially extended activation blobs. uses prior-weighted soft evidence statistic: $$T_\\kappa(R) = \\log \\sum_{v \\R} \\pi(v) \\cdot \\exp(\\kappa \\cdot Z(v))$$ \\(\\pi(v)\\) prior weight \\(\\kappa\\) temperature.","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/neurothresh-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"neurothresh: Neuroimaging Statistical Thresholding with LR-MFT — neurothresh-package","text":"Maintainer: Brad Buchsbaum brad.buchsbaum@gmail.com","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree-wrappers.html","id":null,"dir":"Reference","previous_headings":"","what":"R wrappers for octree operations — octree-wrappers","title":"R wrappers for octree operations — octree-wrappers","text":"functions provide R interfaces C++ octree splitting scoring routines.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":null,"dir":"Reference","previous_headings":"","what":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"Computes multiscale dyadic-cube scan statistic using variance-stabilized prior-weighted mean $$U_0(R) = \\sum_{v \\R}\\pi(v)Z(v)/\\sqrt{\\sum_{v \\R}\\pi(v)^2}$$ dyadic cubes implicit octree, calibrates global threshold maxT permutation (sign-flip) procedure.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"","code":"octree_scan_fwer(   z_vol,   prior_vol = NULL,   mask = NULL,   alpha = 0.05,   n_perm = 1000,   null = c(\"signflip_voxel\", \"mc_fwhm\", \"mc_acf\"),   null_fun = NULL,   fwhm_vox = NULL,   fwhm_mm = NULL,   acf_params = NULL,   seed = NULL,   two_sided = FALSE,   prior_eta = 0.9 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"z_vol 3D volume-like object finite values -brain. prior_vol Optional prior weight volume aligned z_vol. NULL, uniform weights used. mask Optional logical mask (shape z_vol). NULL, uses finite voxels z_vol. alpha Significance level strong FWER control (default 0.05). n_perm Number permutations/sign-flips (default 1000). null Null calibration method. \"mc_fwhm\" Correlated Monte Carlo null via Gaussian smoothing white noise smoothness set fwhm_vox (fwhm_mm NeuroVols). NULL, effective fwhm_vox estimated statistic map using estimate_fwhm_vox. \"mc_acf\" Correlated Monte Carlo null using simple mixed-ACF model (Gaussian + long-tailed exponential) user-supplied parameters acf_params. \"signflip_voxel\" Independent voxelwise sign-flips group map (fast generally invalid regional/multiscale statistics; mainly useful debugging). null_fun Optional function function(b) returning length n_mask Z-vector permutation b. Use supply subject-level randomization preserves spatial covariance. fwhm_vox null=\"mc_fwhm\", Gaussian FWHM voxel units (length 1 3). fwhm_mm null=\"mc_fwhm\", Gaussian FWHM mm (length 1 3). Requires z_vol neuroim2::NeuroVol voxel spacing available. acf_params null=\"mc_acf\", list components: Mixing weight (0, 1) Gaussian component. fwhm_vox Gaussian ACF FWHM voxel units (length 1 3). lambda_vox Exponential kernel scale voxel units (length 1 3). seed Optional RNG seed reproducibility. two_sided Logical; TRUE, uses abs(z_vol) prior sign-flips. prior_eta Mixing weight [0, 1] shrink prior toward uniform mass (default 0.9).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"list components: u Global maxT threshold level alpha. M_obs Observed max scan statistic. M_null Numeric vector permutation maxima. nodes Data frame non-empty dyadic nodes columns level,,j,k,score,scale,x0,x1,y0,y1,z0,z1. sig_nodes Subset nodes score > u. params List run parameters.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"implements simplest global calibration: single-step maxT permutation threshold full dyadic-cube family. single group-level map available, null=\"mc_fwhm\" safer default voxelwise sign-flips preserves assumed spatial autocorrelation model. Exact resampling-based inference typically requires subject-level residual maps; supply null_fun use randomizations. hierarchical step-sibling families descent, see octree_scan_stepdown.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_fwer.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Octree Max-Scan with permutation FWER (U0-only) — octree_scan_fwer","text":"","code":"# Map-only (model-based) calibration using a Gaussian ACF null: z <- array(rnorm(16 * 16 * 16), dim = c(16, 16, 16)) res <- octree_scan_fwer(z, n_perm = 50, null = \"mc_fwhm\", fwhm_vox = c(2, 2, 2))  # User-supplied mixed ACF parameters (Gaussian + long tail): acf <- list(a = 0.7, fwhm_vox = c(4, 4, 4), lambda_vox = c(2, 2, 2)) res2 <- octree_scan_fwer(z, n_perm = 50, null = \"mc_acf\", acf_params = acf)  # Subject-level sign-flips (recommended when subject maps are available): subj <- replicate(8, array(rnorm(16 * 16 * 16), dim = c(16, 16, 16)), simplify = FALSE) sf <- make_null_fun_subject_signflip(subj) res3 <- octree_scan_fwer(sf$z_vol, mask = sf$mask, n_perm = 50, null_fun = sf$null_fun)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_stepdown.html","id":null,"dir":"Reference","previous_headings":"","what":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","title":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","text":"Performs multiscale dyadic-cube search using variance-stabilized prior-weighted mean statistic \\(U_0(R)\\) applies Westfall-Young step-procedure within sibling family octree descent (alpha-spending across tree).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_stepdown.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","text":"","code":"octree_scan_stepdown(   z_vol,   prior_vol = NULL,   mask = NULL,   alpha = 0.05,   n_perm = 1000,   null = c(\"signflip_voxel\", \"mc_fwhm\", \"mc_acf\"),   null_fun = NULL,   fwhm_vox = NULL,   fwhm_mm = NULL,   acf_params = NULL,   gamma = 0.5,   min_voxels = 8,   min_alpha = 1e-06,   report = c(\"coarsest\", \"finest\", \"greedy\"),   seed = NULL,   two_sided = FALSE,   prior_eta = 0.9 )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_stepdown.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","text":"z_vol 3D volume-like object containing Z-equivalent values. prior_vol Optional prior weight volume aligned z_vol. NULL, uniform weights used. mask Optional logical mask (shape z_vol). NULL, uses finite voxels z_vol. alpha FWER target (default 0.05). n_perm Number sign-flip permutations per tested family (default 1000). null Null calibration method. \"mc_fwhm\" Correlated Monte Carlo null via Gaussian smoothing white noise smoothness set fwhm_vox (fwhm_mm NeuroVols). NULL, effective fwhm_vox estimated statistic map using estimate_fwhm_vox. \"mc_acf\" Correlated Monte Carlo null using simple mixed-ACF model (Gaussian + long-tailed exponential) user-supplied parameters acf_params. \"signflip_voxel\" Independent voxelwise sign-flips group map (fast generally invalid regional/multiscale statistics; mainly useful debugging). null_fun Optional function function(b) returning length n_mask Z-vector permutation b. Use supply subject-level randomization preserves spatial covariance. fwhm_vox null=\"mc_fwhm\", Gaussian FWHM voxel units (length 1 3). fwhm_mm null=\"mc_fwhm\", Gaussian FWHM mm (length 1 3). Requires z_vol neuroim2::NeuroVol voxel spacing available. acf_params null=\"mc_acf\", list components: Mixing weight (0, 1) Gaussian component. fwhm_vox Gaussian ACF FWHM voxel units (length 1 3). lambda_vox Exponential kernel scale voxel units (length 1 3). gamma Fraction local alpha budget used test current sibling family (default 0.5). Remaining budget split among rejected children prior mass. min_voxels Minimum child size consider descent (default 8). min_alpha Minimum alpha budget continue descent (default 1e-6). report select non-redundant set regions discovered significant nodes: \"coarsest\", \"finest\", \"greedy\". seed Optional RNG seed. two_sided Logical; TRUE, uses abs(z_vol) observed map permutations (two-sided via absolute Z). prior_eta Mixing weight [0, 1] shrink prior toward uniform mass (default 0.9).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_stepdown.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","text":"list components: hits Data frame discovered significant nodes (may include nested nodes). selected Data frame selected nodes per report. sig_mask Logical mask volume selected nodes. sig_indices 1-based linear indices z_vol sig_mask. params Run parameters.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_scan_stepdown.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Octree scan with hierarchical step-down inference (U0-only) — octree_scan_stepdown","text":"Compared octree_scan_fwer, avoids single global maxT threshold dyadic cubes. Instead, leverages nesting tree tests small sibling families (<= 8) split. Note: global Westfall-Young step-full set dyadic cubes (require joint null distribution hypotheses). Use octree_scan_fwer single-step maxT procedure full dyadic-cube family.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split.html","id":null,"dir":"Reference","previous_headings":"","what":"Recursive octree split — octree_split","title":"Recursive octree split — octree_split","text":"Recursively partitions region octree children regions smaller min_voxels.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Recursive octree split — octree_split","text":"","code":"octree_split(indices, x, y, z, min_voxels = 8)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Recursive octree split — octree_split","text":"indices Integer vector mask-space indices x Integer vector x coordinates (mask-space) y Integer vector y coordinates (mask-space) z Integer vector z coordinates (mask-space) min_voxels Minimum region size continue splitting","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Recursive octree split — octree_split","text":"List index vectors leaf regions","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split_info.html","id":null,"dir":"Reference","previous_headings":"","what":"Build octree split info for a parent node — octree_split_info","title":"Build octree split info for a parent node — octree_split_info","text":"Computes child assignments caches constants needed one-pass scoring children.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split_info.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Build octree split info for a parent node — octree_split_info","text":"","code":"octree_split_info(idx_parent, bbox, x, y, z, pi_vec, min_pi_mass = 1e-10)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split_info.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Build octree split info for a parent node — octree_split_info","text":"idx_parent Integer vector 1-based mask-space indices bbox Integer vector length 6: (x0, x1, y0, y1, z0, z1) x Integer vector x coordinates (mask-space, length N) y Integer vector y coordinates (mask-space, length N) z Integer vector z coordinates (mask-space, length N) pi_vec Numeric vector prior weights (mask-space, length N) min_pi_mass Minimum prior mass keep child (default 1e-10)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/octree_split_info.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Build octree split info for a parent node — octree_split_info","text":"list components: m Number non-empty children (0 8) child_id Integer vector child assignments (-1 0..m-1) w_parent Numeric vector prior weights idx_parent log_den1 Numeric vector log(sum(pi)) per child inv_sqrt_den2 Numeric vector 1/sqrt(sum(pi^2)) per child keep8 Integer vector indicating 1..8 octants kept","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/print.neurothresh_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Print method for neurothresh_result — print.neurothresh_result","title":"Print method for neurothresh_result — print.neurothresh_result","text":"Print method neurothresh_result","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/print.neurothresh_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print method for neurothresh_result — print.neurothresh_result","text":"","code":"# S3 method for class 'neurothresh_result' print(x, ...)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/print.neurothresh_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print method for neurothresh_result — print.neurothresh_result","text":"x neurothresh_result object ... Additional arguments (ignored)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Random Field Theory (RFT) Thresholding Methods — rft-methods","title":"Random Field Theory (RFT) Thresholding Methods — rft-methods","text":"Classic GRF/RFT inference using expected Euler characteristic FWER control. provided baseline comparisons LR-MFT.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_cluster_fwer.html","id":null,"dir":"Reference","previous_headings":"","what":"RFT Cluster-Level FWER — rft_cluster_fwer","title":"RFT Cluster-Level FWER — rft_cluster_fwer","text":"Computes cluster-level FWER-corrected p-values using Random Field Theory cluster extent distribution.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_cluster_fwer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"RFT Cluster-Level FWER — rft_cluster_fwer","text":"","code":"rft_cluster_fwer(   stat_vol,   mask = NULL,   fwhm_mm,   cluster_thresh = 3,   alpha = 0.05,   df = Inf,   tail = c(\"pos\", \"neg\", \"two\") )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_cluster_fwer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"RFT Cluster-Level FWER — rft_cluster_fwer","text":"stat_vol NeuroVol containing statistic map mask Optional LogicalNeuroVol analysis domain fwhm_mm Smoothness mm cluster_thresh Cluster-forming threshold (Z-score) alpha Significance level (default 0.05) df Degrees freedom. Use Inf Gaussian field. tail \"pos\", \"neg\", \"two\"","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_cluster_fwer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"RFT Cluster-Level FWER — rft_cluster_fwer","text":"List components: sig_mask Logical mask significant clusters table Data frame cluster statistics n_clusters Number significant clusters","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_cluster_fwer.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"RFT Cluster-Level FWER — rft_cluster_fwer","text":"First thresholds cluster_thresh form clusters, tests cluster's extent RFT null distribution.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_fwer_twosided.html","id":null,"dir":"Reference","previous_headings":"","what":"Two-sided RFT wrapper — rft_fwer_twosided","title":"Two-sided RFT wrapper — rft_fwer_twosided","text":"Two-sided RFT wrapper","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_fwer_twosided.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Two-sided RFT wrapper — rft_fwer_twosided","text":"","code":"rft_fwer_twosided(stat_vol, method = c(\"peak\", \"cluster\"), ...)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_fwer_twosided.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Two-sided RFT wrapper — rft_fwer_twosided","text":"stat_vol NeuroVol containing statistic map method \"peak\" \"cluster\" ... Additional arguments passed rft_peak_fwer rft_cluster_fwer","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":null,"dir":"Reference","previous_headings":"","what":"RFT Peak-Level FWER — rft_peak_fwer","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"Computes FWER-corrected threshold peak (voxelwise) inference using Random Field Theory.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"","code":"rft_peak_fwer(   stat_vol,   mask = NULL,   fwhm_mm,   alpha = 0.05,   df = Inf,   tail = c(\"pos\", \"neg\", \"two\") )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"stat_vol NeuroVol containing statistic map mask Optional LogicalNeuroVol analysis domain fwhm_mm Smoothness mm. Scalar length-3 vector anisotropic smoothness. alpha Significance level (default 0.05) df Degrees freedom. Use Inf Gaussian field (Z-scores). tail \"pos\" (activations), \"neg\" (deactivations), \"two\"","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"List components: threshold FWER-corrected threshold sig_mask Logical mask significant voxels method \"rft_peak\"","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"Uses expected Euler characteristic approximation: $$P(\\max Z > u) \\approx \\sum_{d=0}^{D} \\text{Resels}_d \\cdot EC_d(u)$$ high thresholds smooth Gaussian fields, provides accurate FWER control.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/rft_peak_fwer.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"RFT Peak-Level FWER — rft_peak_fwer","text":"","code":"if (FALSE) { # \\dontrun{ result <- rft_peak_fwer(z_map, fwhm_mm = 8, alpha = 0.05) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_children_onepass.html","id":null,"dir":"Reference","previous_headings":"","what":"Score all children in one pass through parent voxels — score_children_onepass","title":"Score all children in one pass through parent voxels — score_children_onepass","text":"Computes omnibus score (max U_0 best S_kappa) children single O(n) pass parent voxels.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_children_onepass.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Score all children in one pass through parent voxels — score_children_onepass","text":"","code":"score_children_onepass(Z_vec, idx_parent, split, kappa_grid, do_abs = FALSE)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_children_onepass.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Score all children in one pass through parent voxels — score_children_onepass","text":"Z_vec Numeric vector Z-scores (mask-space, length N) idx_parent Integer vector parent mask-space indices split List returned octree_split_info kappa_grid Numeric vector positive kappa values do_abs Logical, whether take absolute value Z (two-sided)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_children_onepass.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Score all children in one pass through parent voxels — score_children_onepass","text":"Numeric vector length m child scores","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"Computes prior-weighted log-sum-exp statistic region R: $$T_\\kappa(R) = \\log \\sum_{v \\R} \\pi(v) \\cdot \\exp(\\kappa \\cdot Z(v))$$","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"","code":"score_set(indices, z_vec, pi_vec, kappa = 1)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"indices Integer vector 1-based mask-space indices defining region z_vec Numeric vector Z-scores mask-space pi_vec Numeric vector prior weights mask-space kappa Numeric scalar, temperature parameter (default 1.0). Higher kappa emphasizes peaks; kappa -> 0 gives diffuse detection.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"Numeric scalar, T_kappa score region","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"core statistic LR-MFT. kappa = 0, use score_set_stabilized instead variance-stabilized diffuse detection.","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute prior-weighted soft evidence statistic T_kappa(R) — score_set","text":"","code":"if (FALSE) { # \\dontrun{ # Score a region with 100 voxels z_vec <- rnorm(1000) pi_vec <- rep(1, 1000) indices <- 1:100 score <- score_set(indices, z_vec, pi_vec, kappa = 1.0) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_omnibus.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","title":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","text":"Computes maximum variance-stabilized diffuse score U_0 best soft-max score S_kappa across grid kappa values.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_omnibus.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","text":"","code":"score_set_omnibus(indices, z_vec, pi_vec, kappa_grid = c(0.5, 1, 2))"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_omnibus.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","text":"indices Integer vector 1-based mask-space indices z_vec Numeric vector Z-scores mask-space pi_vec Numeric vector prior weights mask-space kappa_grid Numeric vector positive kappa values try","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_omnibus.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","text":"list components: T_omnibus maximum score across statistics U0 variance-stabilized diffuse score S_best best soft-max score kappa_best kappa value gave S_best","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_omnibus.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute omnibus score combining diffuse and focal detection — score_set_omnibus","text":"omnibus statistic : $$T(R) = \\max(U_0(R), \\max_{\\kappa} S_\\kappa(R))$$ S_kappa normalized soft-max: $$S_\\kappa(R) = \\frac{1}{\\kappa} \\left[ \\log \\sum \\pi \\exp(\\kappa Z) - \\log \\sum \\pi \\right]$$","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute variance-stabilized score U_0(R) — score_set_stabilized","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"Computes variance-stabilized diffuse detection score: $$U_0(R) = \\frac{\\sum_{v \\R} \\pi(v) \\cdot Z(v)}{\\sqrt{\\sum_{v \\R} \\pi(v)^2}}$$","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"","code":"score_set_stabilized(indices, z_vec, pi_vec)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"indices Integer vector 1-based mask-space indices defining region z_vec Numeric vector Z-scores mask-space pi_vec Numeric vector prior weights mask-space","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"list components: U0 variance-stabilized score n_eff effective sample size: (sum(pi))^2 / sum(pi^2)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"provides fair comparison across regions different sizes normalizing effective sample size. null hypothesis, U_0(R) approximately unit variance regardless region size, enabling fair comparison across scales. effective sample size n_eff represents equivalent number independent observations.","code":""},{"path":[]},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/score_set_stabilized.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute variance-stabilized score U_0(R) — score_set_stabilized","text":"","code":"if (FALSE) { # \\dontrun{ # Compare scores across regions of different sizes z_vec <- rnorm(1000) pi_vec <- rep(1, 1000)  # Small region small <- score_set_stabilized(1:10, z_vec, pi_vec)  # Large region large <- score_set_stabilized(1:100, z_vec, pi_vec)  # Both have comparable variance under null } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_child_indices.html","id":null,"dir":"Reference","previous_headings":"","what":"Split parent indices into child index lists — split_child_indices","title":"Split parent indices into child index lists — split_child_indices","text":"Partitions parent voxel indices lists child, recursive descent.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_child_indices.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Split parent indices into child index lists — split_child_indices","text":"","code":"split_child_indices(idx_parent, split)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_child_indices.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Split parent indices into child index lists — split_child_indices","text":"idx_parent Integer vector parent mask-space indices split List returned octree_split_info","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_child_indices.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Split parent indices into child index lists — split_child_indices","text":"List m IntegerVectors, one per child","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox.html","id":null,"dir":"Reference","previous_headings":"","what":"Split indices with bounding boxes — split_indices_bbox","title":"Split indices with bounding boxes — split_indices_bbox","text":"Splits parent indices children computes bounding box child single pass.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Split indices with bounding boxes — split_indices_bbox","text":"","code":"split_indices_bbox(idx_parent, split, x, y, z)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Split indices with bounding boxes — split_indices_bbox","text":"idx_parent Integer vector parent mask-space indices split List returned octree_split_info x Integer vector x coordinates y Integer vector y coordinates z Integer vector z coordinates","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Split indices with bounding boxes — split_indices_bbox","text":"List components: idx List m IntegerVectors child indices bbox Integer matrix (m x 6) child bounding boxes","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox_mass.html","id":null,"dir":"Reference","previous_headings":"","what":"Split indices with bounding boxes and prior masses — split_indices_bbox_mass","title":"Split indices with bounding boxes and prior masses — split_indices_bbox_mass","text":"Like split_indices_bbox also computes sum(pi) sum(pi^2) child alpha allocation.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox_mass.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Split indices with bounding boxes and prior masses — split_indices_bbox_mass","text":"","code":"split_indices_bbox_mass(idx_parent, split, x, y, z, pi_vec)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox_mass.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Split indices with bounding boxes and prior masses — split_indices_bbox_mass","text":"idx_parent Integer vector parent mask-space indices split List returned octree_split_info x Integer vector x coordinates y Integer vector y coordinates z Integer vector z coordinates pi_vec Numeric vector prior weights","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/split_indices_bbox_mass.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Split indices with bounding boxes and prior masses — split_indices_bbox_mass","text":"List components: idx List m IntegerVectors child indices bbox Integer matrix (m x 6) child bounding boxes den1 Numeric vector sum(pi) per child den2 Numeric vector sum(pi^2) per child","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/summary.neurothresh_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary method for neurothresh_result — summary.neurothresh_result","title":"Summary method for neurothresh_result — summary.neurothresh_result","text":"Summary method neurothresh_result","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/summary.neurothresh_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary method for neurothresh_result — summary.neurothresh_result","text":"","code":"# S3 method for class 'neurothresh_result' summary(object, ...)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/summary.neurothresh_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary method for neurothresh_result — summary.neurothresh_result","text":"object neurothresh_result object ... Additional arguments (ignored)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/test_parcels.html","id":null,"dir":"Reference","previous_headings":"","what":"Test at parcel level with step-down — test_parcels","title":"Test at parcel level with step-down — test_parcels","text":"Tests parcels simultaneously using Westfall-Young step-, returns significant parcels descent.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/test_parcels.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test at parcel level with step-down — test_parcels","text":"","code":"test_parcels(   z_vec,   pi_vec,   lab_vec,   n_perm,   kappa_grid,   alpha = 0.05,   seed = NULL )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/test_parcels.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test at parcel level with step-down — test_parcels","text":"z_vec Numeric vector Z-scores (mask-space) pi_vec Numeric vector prior weights (mask-space) lab_vec Integer vector parcel labels (mask-space) n_perm Number permutations kappa_grid Numeric vector positive kappa values alpha Significance level seed Random seed (optional)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/test_parcels.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test at parcel level with step-down — test_parcels","text":"List components: stepdown Data frame wy_stepdown sig_parcels Integer vector significant parcel labels parcel_indices List index vectors parcel","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Threshold-Free Cluster Enhancement (TFCE) — tfce-methods","title":"Threshold-Free Cluster Enhancement (TFCE) — tfce-methods","text":"Implementation FSL-style TFCE threshold-free cluster enhancement permutation-based FWER control.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_fwer.html","id":null,"dir":"Reference","previous_headings":"","what":"TFCE with Permutation FWER — tfce_fwer","title":"TFCE with Permutation FWER — tfce_fwer","text":"Computes TFCE permutation-based FWER control using maxT procedure.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_fwer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"TFCE with Permutation FWER — tfce_fwer","text":"","code":"tfce_fwer(   stat_vol,   mask = NULL,   n_perm = 5000,   H = 2,   E = 0.5,   dh = 0.1,   alpha = 0.05,   seed = NULL,   tail = c(\"pos\", \"neg\", \"two\") )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_fwer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"TFCE with Permutation FWER — tfce_fwer","text":"stat_vol NeuroVol containing statistic map mask Optional LogicalNeuroVol analysis domain n_perm Number permutations (default 5000) H Height exponent (default 2.0) E Extent exponent (default 0.5) dh Threshold increment (default 0.1) alpha Significance level (default 0.05) seed Random seed reproducibility tail \"pos\", \"neg\", \"two\"","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_fwer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"TFCE with Permutation FWER — tfce_fwer","text":"List components: tfce TFCE-transformed observed map threshold FWER-corrected threshold sig_mask Logical mask significant voxels p_corr Voxelwise FWER-corrected p-values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":null,"dir":"Reference","previous_headings":"","what":"TFCE Transform — tfce_transform","title":"TFCE Transform — tfce_transform","text":"Computes Threshold-Free Cluster Enhancement transform: $$TFCE(v) = \\int_0^{h_v} e(h)^E \\cdot h^H \\, dh$$","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"TFCE Transform — tfce_transform","text":"","code":"tfce_transform(   stat_vol,   mask = NULL,   H = 2,   E = 0.5,   dh = 0.1,   tail = c(\"pos\", \"neg\") )"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"TFCE Transform — tfce_transform","text":"stat_vol NeuroVol containing statistic map mask Optional LogicalNeuroVol analysis domain H Height exponent (default 2.0) E Extent exponent (default 0.5) dh Threshold increment (default 0.1) tail \"pos\" activations, \"neg\" deactivations","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"TFCE Transform — tfce_transform","text":"NeuroVol TFCE-transformed values","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"TFCE Transform — tfce_transform","text":"e(h) extent cluster containing voxel v threshold h. TFCE provides threshold-free inference integrating cluster extent range thresholds. Default parameters (H=2, E=0.5) recommended Smith & Nichols (2009).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"TFCE Transform — tfce_transform","text":"Smith, S. M., & Nichols, T. E. (2009). Threshold-free cluster enhancement: Addressing problems smoothing, threshold dependence localisation cluster inference. NeuroImage, 44(1), 83-98.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/tfce_transform.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"TFCE Transform — tfce_transform","text":"","code":"if (FALSE) { # \\dontrun{ tfce_map <- tfce_transform(z_map, H = 2, E = 0.5) } # }"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":null,"dir":"Reference","previous_headings":"","what":"Westfall-Young Step-Down Procedure — wy_stepdown","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"Implements Westfall-Young step-maxT procedure strong control family-wise error rate (FWER).","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"","code":"wy_stepdown(observed, null_matrix, alpha = 0.05)"},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"observed Numeric vector observed test statistics null_matrix Matrix null statistics (n_perm x n_tests) alpha Significance level (default 0.05)","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"data.frame columns: region Index region (1 n_tests) score Observed test statistic p_adj Adjusted p-value (monotonically non-decreasing) rejected Logical, whether null rejected","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"Westfall-Young step-procedure provides strong FWER control higher power single-step methods : Sorting regions observed score (descending) Computing successive maxima null distribution Ensuring adjusted p-values monotonically non-decreasing recommended method hierarchical LR-MFT preserves logical ordering rejections.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"Westfall, P. H., & Young, S. S. (1993). Resampling-based multiple testing: Examples methods p-value adjustment. Wiley.","code":""},{"path":"https://bbuchsbaum.github.io/neurothresh/reference/wy_stepdown.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Westfall-Young Step-Down Procedure — wy_stepdown","text":"","code":"if (FALSE) { # \\dontrun{ # Observed scores for 5 regions observed <- c(3.5, 2.1, 4.2, 1.8, 2.9)  # Null distribution from 1000 permutations null_matrix <- matrix(rnorm(5000), nrow = 1000, ncol = 5)  # Run step-down procedure result <- wy_stepdown(observed, null_matrix, alpha = 0.05) } # }"}]
